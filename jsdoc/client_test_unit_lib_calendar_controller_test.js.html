<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Blood Test Diary Documentation Source: client/test/unit/lib/calendar_controller_test.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.readable.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Blood Test Diary Documentation</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-action-logger.html">action-logger</a></li><li><a href="module-action-logger-test.html">action-logger-test</a></li><li><a href="module-authenicator.html">authenicator</a></li><li><a href="module-authenticator-test.html">authenticator-test</a></li><li><a href="module-calendar-controller.html">calendar-controller</a></li><li><a href="module-calendar-functions.html">calendar-functions</a></li><li><a href="module-db-controller.html">db-controller</a></li><li><a href="module-db_controller_test.html">db_controller_test</a></li><li><a href="module-email-controller.html">email-controller</a></li><li><a href="module-email-generator.html">email-generator</a></li><li><a href="module-email-sender.html">email-sender</a></li><li><a href="module-json-controller.html">json-controller</a></li><li><a href="module-json-parser.html">json-parser</a></li><li><a href="module-logger.html">logger</a></li><li><a href="module-overdue-controller.html">overdue-controller</a></li><li><a href="module-query-controller.html">query-controller</a></li><li><a href="module-report-generator.html">report-generator</a></li><li><a href="module-server.html">server</a></li><li><a href="module-serverConnection.html">serverConnection</a></li><li><a href="module-token-functions-test.html">token-functions-test</a></li><li><a href="module-token-generator.html">token-generator</a></li><li><a href="module-token-generator-test.html">token-generator-test</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="Database.html">Database</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#addCarer">addCarer</a></li><li><a href="global.html#addHospital">addHospital</a></li><li><a href="global.html#addPatient">addPatient</a></li><li><a href="global.html#addTest">addTest</a></li><li><a href="global.html#addUser">addUser</a></li><li><a href="global.html#arraysOfDatesEqual">arraysOfDatesEqual</a></li><li><a href="global.html#callCommand">callCommand</a></li><li><a href="global.html#changePatientColour">changePatientColour</a></li><li><a href="global.html#changeTestStatus">changeTestStatus</a></li><li><a href="global.html#characterCheck">characterCheck</a></li><li><a href="global.html#checkMultipleQueriesStatus">checkMultipleQueriesStatus</a></li><li><a href="global.html#deleteCarer">deleteCarer</a></li><li><a href="global.html#deleteHospital">deleteHospital</a></li><li><a href="global.html#deletePatient">deletePatient</a></li><li><a href="global.html#deleteQueryDatabase">deleteQueryDatabase</a></li><li><a href="global.html#deleteTest">deleteTest</a></li><li><a href="global.html#editCarer">editCarer</a></li><li><a href="global.html#editHospital">editHospital</a></li><li><a href="global.html#editPatient">editPatient</a></li><li><a href="global.html#editTest">editTest</a></li><li><a href="global.html#editUser">editUser</a></li><li><a href="global.html#emailCheck">emailCheck</a></li><li><a href="global.html#emptyCheck">emptyCheck</a></li><li><a href="global.html#getAllPatients">getAllPatients</a></li><li><a href="global.html#getAllUsers">getAllUsers</a></li><li><a href="global.html#getCarer">getCarer</a></li><li><a href="global.html#getCompletedLateInMonth">getCompletedLateInMonth</a></li><li><a href="global.html#getCompletedOnTimeInMonth">getCompletedOnTimeInMonth</a></li><li><a href="global.html#getDueTestsInMonth">getDueTestsInMonth</a></li><li><a href="global.html#getFullPatientInfo">getFullPatientInfo</a></li><li><a href="global.html#getHospital">getHospital</a></li><li><a href="global.html#getLastLineOfFile">getLastLineOfFile</a></li><li><a href="global.html#getMonthAndYear">getMonthAndYear</a></li><li><a href="global.html#getMonthName">getMonthName</a></li><li><a href="global.html#getNextTestsOfPatient">getNextTestsOfPatient</a></li><li><a href="global.html#getNumberOfRemindersSent">getNumberOfRemindersSent</a></li><li><a href="global.html#getOverdueReminderGroups">getOverdueReminderGroups</a></li><li><a href="global.html#getPatient">getPatient</a></li><li><a href="global.html#getPatientsNumber">getPatientsNumber</a></li><li><a href="global.html#getTest">getTest</a></li><li><a href="global.html#getTestInfo">getTestInfo</a></li><li><a href="global.html#getTestsDuringTheWeek">getTestsDuringTheWeek</a></li><li><a href="global.html#getTestWithinWeek">getTestWithinWeek</a></li><li><a href="global.html#getUser">getUser</a></li><li><a href="global.html#insertQueryDatabase">insertQueryDatabase</a></li><li><a href="global.html#integerCheck">integerCheck</a></li><li><a href="global.html#intRegex">intRegex</a></li><li><a href="global.html#prepareDeleteSQL">prepareDeleteSQL</a></li><li><a href="global.html#prepareInsertSQL">prepareInsertSQL</a></li><li><a href="global.html#prepareUpdateSQL">prepareUpdateSQL</a></li><li><a href="global.html#requestEditing">requestEditing</a></li><li><a href="global.html#returnToken">returnToken</a></li><li><a href="global.html#selectQueryDatabase">selectQueryDatabase</a></li><li><a href="global.html#sleep">sleep</a></li><li><a href="global.html#updateLastReminder">updateLastReminder</a></li><li><a href="global.html#updateQueryDatabase">updateQueryDatabase</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: client/test/unit/lib/calendar_controller_test.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">const chai = require('chai');
const should = chai.should();

const calendar_controller = require('../../../src/lib/calendar-controller');

/**
 * Test if the getNextDates works when given strings with the right format
 */
describe("Test working frequency formats", function () {
    it('should return 13 dates, each 1 day apart.', function () {
        const expected = [
            new Date(2018, 0, 2),
            new Date(2018, 0, 3),
            new Date(2018, 0, 4),
            new Date(2018, 0, 5),
            new Date(2018, 0, 6),
            new Date(2018, 0, 7),
            new Date(2018, 0, 8),
            new Date(2018, 0, 9),
            new Date(2018, 0, 10),
            new Date(2018, 0, 11),
            new Date(2018, 0, 12),
            new Date(2018, 0, 13),
            new Date(2018, 0, 14),
            new Date(2018, 0, 15),
            new Date(2018, 0, 16)

        ]

        const result = calendar_controller.getNextDates('1-D:15', new Date(2018, 0, 1));

        arraysOfDatesEqual(result, expected).should.be.true;
    });

    it('should return 15 dates, each 1 year apart. Starting from 1st Jan 2018', function () {
        const expected = [
            new Date(2019, 0, 1),
            new Date(2020, 0, 1),
            new Date(2021, 0, 1),
            new Date(2022, 0, 1),
            new Date(2023, 0, 1),
            new Date(2024, 0, 1),
            new Date(2025, 0, 1),
            new Date(2026, 0, 1),
            new Date(2027, 0, 1),
            new Date(2028, 0, 1),
            new Date(2029, 0, 1),
            new Date(2030, 0, 1),
            new Date(2031, 0, 1),
            new Date(2032, 0, 1),
            new Date(2033, 0, 1)
        ]

        const result = calendar_controller.getNextDates('1-Y:15', new Date(2018, 0, 1));

        arraysOfDatesEqual(result, expected).should.be.true
    });

    it('should return 15 dates, each 1 week apart. Starting from 30th Dec 2018', function () {
        const expected = [
            new Date(2019, 0, 6), //1
            new Date(2019, 0, 13), //2
            new Date(2019, 0, 20), //3
            new Date(2019, 0, 27), //4
            new Date(2019, 1, 3), //5
            new Date(2019, 1, 10), //6
            new Date(2019, 1, 17), //7
            new Date(2019, 1, 24), //8
            new Date(2019, 2, 3), //9
            new Date(2019, 2, 10), //10
            new Date(2019, 2, 17), //11
            new Date(2019, 2, 24), //12
            new Date(2019, 2, 31), //13
            new Date(2019, 3, 7), //14
            new Date(2019, 3, 14) //15
        ]

        const result = calendar_controller.getNextDates('1-W:15', new Date(2018, 11, 30));

        arraysOfDatesEqual(result, expected).should.be.true
    });

    it('should return 1/1/2020 when inputting "1-D:1" on the 31/12/2019', function () {
        const expected = [
            new Date(2020, 0, 1)
        ]
        const result = calendar_controller.getNextDates('1-D:1', new Date(2019, 11, 31));

        arraysOfDatesEqual(result, expected).should.be.true;

    });

    it('should return 7/1/2020 when inputting "1-W:1" on the 31/12/2019', function () {
        const expected = [
            new Date(2020, 0, 7)
        ]
        const result = calendar_controller.getNextDates('1-W:1', new Date(2019, 11, 31));

        arraysOfDatesEqual(result, expected).should.be.true;

    });
});

/**
 * Test if the getNextDates returns null when given strings with the wrong format
 */
describe("Test not frequency formats", function () {
    it('should return null on wrong frequency formats', function () {
        const wrong_formats = [
            '', 'a', '-1', 1, null, 0, true, false, [], '-1', 'ß', '1/0', 0.2,
            'Y-4', 'A-Y', '1-R', '/1-D', '0.5-D', 'L-D', '/1-W', '0.5-W', 'L-W',
            '/1-Y', '0.5-Y', 'L-Y'
        ]
        const wrong_n = ['1[', "s", 3, '', 'a', '-1', 1, null, 0, true, false, [], '-1', 'ß', '1/0', 0.2,
            'Y-4', 'A-Y', '1-R', '/1-D', '0.5-D', 'L-D', '/1-W', '0.5-W', 'L-W',
            '/1-W', '0.5-W', 'L-W'
        ]
        wrong_formats.forEach(format => {
            wrong_n.forEach(frequency => {

                const temp = format;
                format += (":" + frequency);
                const result = calendar_controller.getNextDates(format, new Date(2019, 11, 31));
                result.forEach(d => {
                    should.not.exist(d);
                });
                format = temp;
            });
        });
    });
});

describe("Test week handling", function() {
    const testDays = [ (new Date(2019, 1, 20)), (new Date(2019, 2, 1)), (new Date(2019, 5, 20)),  (new Date(2019, 2, 24)), 
                       (new Date(2019, 2, 31)), (new Date(2019, 3, 12))];
    it ("Should return the correct monday date given any date", function(){
        let results = [];
        testDays.forEach( day => {
            const monday = calendar_controller.getMondayOfWeek(day);
            results = results.concat(monday);
        });

        results[0].getDate().should.equal(18);
        results[0].getMonth().should.equal(1);
        results[0].getFullYear().should.equal(2019);
        results[1].getDate().should.equal(25);
        results[1].getMonth().should.equal(1);
        results[1].getFullYear().should.equal(2019);
        results[2].getDate().should.equal(17);
        results[2].getMonth().should.equal(5);
        results[2].getFullYear().should.equal(2019);
        results[3].getDate().should.equal(18);
        results[3].getMonth().should.equal(2);
        results[3].getFullYear().should.equal(2019);
        results[4].getDate().should.equal(25);
        results[4].getMonth().should.equal(2);
        results[4].getFullYear().should.equal(2019);
        results[5].getDate().should.equal(8);
        results[5].getMonth().should.equal(3);
        results[5].getFullYear().should.equal(2019);

    });

    it ("Should return the correct previous week given a well formed week", function() {

        const weekTest1 = [(new Date(2019, 1, 25)), (new Date(2019, 1, 26)), (new Date(2019, 1, 27)),
                           (new Date(2019, 1, 28)), (new Date(2019, 2, 1)), (new Date(2019,2,2))];
        const weekTest2 = [(new Date(2019, 2, 25)), (new Date(2019, 2, 26)), (new Date(2019, 2, 27)),
                           (new Date(2019, 2, 28)), (new Date(2019, 2, 29)), (new Date(2019, 2, 30))];

        let result1 = [];
        calendar_controller.getPreviousWeek(weekTest1).forEach(day => {
            day = new Date(day.getFullYear(), day.getMonth(), day.getDate());
            result1 = result1.concat(day);
        });

        result1[0].getDate().should.equal(18);
        result1[0].getMonth().should.equal(1);
        result1[0].getFullYear().should.equal(2019);
        result1[1].getDate().should.equal(19);
        result1[1].getMonth().should.equal(1);
        result1[1].getFullYear().should.equal(2019);
        result1[2].getDate().should.equal(20);
        result1[2].getMonth().should.equal(1);
        result1[2].getFullYear().should.equal(2019);
        result1[3].getDate().should.equal(21);
        result1[3].getMonth().should.equal(1);
        result1[3].getFullYear().should.equal(2019);
        result1[4].getDate().should.equal(22);
        result1[4].getMonth().should.equal(1);
        result1[4].getFullYear().should.equal(2019);
        result1[5].getDate().should.equal(23);
        result1[5].getMonth().should.equal(1);
        result1[5].getFullYear().should.equal(2019);

        let result2 = [];
        calendar_controller.getPreviousWeek(weekTest2).forEach(day => {
            day =  new Date(day.getFullYear(), day.getMonth(), day.getDate());
            result2 = result2.concat(day);
        });

        result2[0].getDate().should.equal(18);
        result2[0].getMonth().should.equal(2);
        result2[0].getFullYear().should.equal(2019);
        result2[1].getDate().should.equal(19);
        result2[1].getMonth().should.equal(2);
        result2[1].getFullYear().should.equal(2019);
        result2[2].getDate().should.equal(20);
        result2[2].getMonth().should.equal(2);
        result2[2].getFullYear().should.equal(2019);
        result2[3].getDate().should.equal(21);
        result2[3].getMonth().should.equal(2);
        result2[3].getFullYear().should.equal(2019);
        result2[4].getDate().should.equal(22);
        result2[4].getMonth().should.equal(2);
        result2[4].getFullYear().should.equal(2019);
        result2[5].getDate().should.equal(23);
        result2[5].getMonth().should.equal(2);
        result2[5].getFullYear().should.equal(2019);

    });

    it ("Should return the correct next week given a well formed week", function() {
        const weekTest3 = [(new Date(2019, 1, 25)), (new Date(2019, 1, 26)), (new Date(2019, 1, 27)),
                           (new Date(2019, 1, 28)), (new Date(2019, 2, 1)), (new Date(2019,2,2))];

        let result3 = [];
        calendar_controller.getNextWeek(weekTest3).forEach(day => {
            day = new Date(day.getFullYear(), day.getMonth(), day.getDate());
            result3 = result3.concat(day);
        });

        result3[0].getDate().should.equal(4);
        result3[0].getMonth().should.equal(2);
        result3[0].getFullYear().should.equal(2019);
        result3[1].getDate().should.equal(5);
        result3[1].getMonth().should.equal(2);
        result3[1].getFullYear().should.equal(2019);
        result3[2].getDate().should.equal(6);
        result3[2].getMonth().should.equal(2);
        result3[2].getFullYear().should.equal(2019);
        result3[3].getDate().should.equal(7);
        result3[3].getMonth().should.equal(2);
        result3[3].getFullYear().should.equal(2019);
        result3[4].getDate().should.equal(8);
        result3[4].getMonth().should.equal(2);
        result3[4].getFullYear().should.equal(2019);
        result3[5].getDate().should.equal(9);
        result3[5].getMonth().should.equal(2);
        result3[5].getFullYear().should.equal(2019);

        const weekTest4 = [(new Date(2019, 2, 25)), (new Date(2019, 2, 26)), (new Date(2019, 2, 27)),
                           (new Date(2019, 2, 28)), (new Date(2019, 2, 29)), (new Date(2019,2,30))];

        let result4 = []
        calendar_controller.getNextWeek(weekTest4).forEach(day => {
            day = new Date(day.getFullYear(), day.getMonth(), day.getDate());
            result4 = result4.concat(day);
        });

        result4[0].getDate().should.equal(1);
        result4[0].getMonth().should.equal(3);
        result4[0].getFullYear().should.equal(2019);
        result4[1].getDate().should.equal(2);
        result4[1].getMonth().should.equal(3);
        result4[1].getFullYear().should.equal(2019);
        result4[2].getDate().should.equal(3);
        result4[2].getMonth().should.equal(3);
        result4[2].getFullYear().should.equal(2019);
        result4[3].getDate().should.equal(4);
        result4[3].getMonth().should.equal(3);
        result4[3].getFullYear().should.equal(2019);
        result4[4].getDate().should.equal(5);
        result4[4].getMonth().should.equal(3);
        result4[4].getFullYear().should.equal(2019);
        result4[5].getDate().should.equal(6);
        result4[5].getMonth().should.equal(3);
        result4[5].getFullYear().should.equal(2019);
    });

});

/**
 * Check if two arrays containing dates have
 * the same values
 * @param {array1} _arr1
 * @param {array2} _arr2
 */
function arraysOfDatesEqual(_arr1, _arr2) {

    if (!Array.isArray(_arr1) || !Array.isArray(_arr2) || _arr1.length !== _arr2.length)
        return false;

    const arr1 = _arr1.concat().sort();
    const arr2 = _arr2.concat().sort();

    for (let i = 0; i &lt; arr1.length; i++) {

        if (arr1[i].getDate() != arr2[i].getDate())
            return false;
        if (arr1[i].getMonth() != arr2[i].getMonth())
            return false;
        if (arr1[i].getFullYear() != arr2[i].getFullYear())
            return false;

    }

    return true;

}
</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
	
		on Wed Mar 27th 2019
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
